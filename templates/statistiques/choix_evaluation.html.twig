{% extends 'base.html.twig' %}

{% block titrePage %}Choisir l'évaluation pour laquelle vous désirez consulter les statistiques{% endblock %}

{% block statistiques %}active{% endblock %}

{% block contenu %}
    {{ form_start(form) }}
    {{form_errors(form.evaluations)}}
    <div class="table-responsive table-hover">
        <table class="table" id= "groupes">
            <thead>
            <th></th>
            <th>Nom</th>
            <th>Date</th>
            <th>Groupe</th>
            <th>Créateur</th>
            </thead>
            <tbody>
            {% for evaluation in form.evaluations %}
                {#store index of the category in a variable#}
                {% set index = evaluation.vars.value %}
                {#get entity object from its index in the Categories Field#}
                {% set entity = form.evaluations.vars.choices[index].data %}
                <tr>
                    <td>{{form_widget(form.evaluations[index])}}</td>
                    <td>{{entity.nom}}</td>
                    <td>{{ entity.date|date("d/m/Y") }}</td>
                    <td>{{entity.groupe.nom}}</td>
                    <td>{{entity.enseignant.prenom}} {{entity.enseignant.nom}}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <div class='bouton' align=center>
        <button class="d-sm-inline-block btn btn-sm btn-primary shadow-sm">Personnaliser les statistiques</button>
    </div>
    {{ form_end(form) }}
{% endblock %}

{% block datatables %}

    <script type="text/javascript">

        var table = $('#groupes').DataTable({
            language: {
                // Suppression du label Rechercher et ajout du placeholder
                search: "_INPUT_",
                searchPlaceholder: "Rechercher...",
                "url": "{{asset('tradfr.json')}}"
            },
            order: [2, 'asc'],
            columns: [{"orderable": false}, null, null, {"orderable": false}, null],
            lengthMenu: [
                [15, 30, 45, -1],
                [15, 30, 45, "Tout"]
            ],
            pageLength : {{ app.user.preferenceNbElementsTableaux }}, <!-- Pour que le nombre d'éléments affichés par défaut soit celui de la préference de l'utilisateur -->
            info: false,
        });

        $("[name='form']").on('submit', function () {
            table.rows().nodes().page.len(-1).draw(); // Cette fonction permet, avant la soumission du formulaire, d'afficher dans le DOM toutes les lignes du tableau pour qu'aucune ne soit ignorée
        });
    </script>

{% endblock %}
